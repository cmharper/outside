const SCALE_TEMPERATURE=chroma.scale(["#000413","#072275","#7e8cb7","#f4f5f9","#fed664","#ffa447","#f36233","#d92332"]).domain([-30,-20,-10,0,15,25,30,36]),SCALE_UV=chroma.scale(["#757575","#41aa48","#fae300","#f37721","#e22426","#a289bf"]).domain([2,4,6,8,10,12]),SCALE_OZONE=chroma.scale(["#ffff00","#fbcb01","#ff7300","#ff0000"]).domain([100,160,240,241]),ICONS=["clear-day","clear-night","rain","snow","sleet","wind","fog","cloudy","partly-cloudy-day","partly-cloudy-night"],AVAILABLE=["time","temperature","humidity","battery","summary","icon","temp","pressure","wind","gust","direction","cloud_cover","uv","visibility","ozone"],MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"],DAYS=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],LOCATIONS=["Nailsea"];var LAST_UPDATED=[];for(var l in LOCATIONS)LAST_UPDATED[LOCATIONS[l]]=null;var ss,chroma,SunCalc,Skycons,Feels,BACKGROUND_COLOURS=[];Date.fromJulian=function(k){k=+k+30/86400;var p=Date.julianArray(k,!0);return new Date(Date.UTC.apply(Date,p))},Date.julianArray=function(k,p){var v,x,B,E,G,H,O,P,Q,R,S,q=Math.floor;k+=0.5,v=86400*(k-q(k)),S=q(k),P=k-S,2299161>S?B=S:(Q=q((S-1867216.25)/36524.25),B=S+1+Q-q(Q/4)),E=B+1524,G=q((E-122.1)/365.25),H=q(365.25*G),O=q((E-H)/30.6001),R=q(14>O?O-1:O-13),x=[q(2<R?G-4716:G-4715),R-1,q(E-H-q(30.6001*O)+P)];var T=[q(v/3600),q(v/60%60),Math.round(v%60)];return x=x.concat(T),"number"==typeof p?x.slice(0,p):x},Date.getSeasons=function(k,p){if(k=k||new Date().getUTCFullYear(),1e3>k||3e3<k)throw k+" is out of range";for(var E,G,H,O,q=(k-2e3)/1e3,v=q*q,x=v*q,B=x*q,P=0,Q=0,R=Math.degCos,S=[k],T=[485,203,199,182,156,136,77,74,70,58,52,50,45,44,29,18,17,16,14,12,12,12,9,8],U=[324.96,337.23,342.08,27.85,73.14,171.52,222.54,296.72,243.58,119.81,297.17,21.02,247.54,325.15,60.93,155.12,288.79,198.04,199.76,95.39,287.11,320.81,227.73,15.45],V=[1934.136,32964.467,20.186,445267.112,45036.886,22518.443,65928.934,3034.906,9037.513,33718.147,150.678,2281.226,29929.562,31555.956,4443.417,67555.328,4562.452,62894.029,31436.921,14577.848,31931.756,34777.259,1222.114,16859.074];4>Q;){0==Q?E=2451623.80984+365242.37404*q+0.05169*v-0.00411*x-5.7e-4*B:1==Q?E=2451716.56767+365241.62603*q+0.00325*v+0.00888*x-3e-4*B:2==Q?E=2451810.21715+365242.01767*q-0.11575*v+0.00337*x+7.8e-4*B:3==Q?E=2451900.05952+365242.74049*q-0.06223*v-0.00823*x+3.2e-4*B:void 0,G=(E-2451545)/36525,H=35999.373*G-2.47,O=1+0.0334*R(H)+7e-4*R(2*H),P=0;for(var W=0;24>W;W++)P+=T[W]*R(U[W]+V[W]*G);E+=1e-5*P/O,S[++Q]=Date.fromJulian(E)}return p&&S[p]?S[p]:S},Date.prototype.toRelativeTime=function(){var k=function(B){return B||(B=0),"string"==typeof B&&(B=parseInt(B,10)),"number"==typeof B?(isNaN(B)&&(B=0),{nowThreshold:B}):B},p=function(B,E,G){var H=B.getUTCDay(),O=H-E.getUTCDay();return(0==O?G.today:-1==O?G.yesterday:1==O&&E<B?G.tomorrow:"on "+G.days[H])+" "+G.at+" "+B.toLocaleTimeString().slice(0,5)},q={millisecond:1,second:1e3,minute:60,hour:60,day:24,month:30,year:12},v=q.millisecond*q.second*q.minute*q.hour*q.day,x={today:"today",yesterday:"yesterday",tomorrow:"tomorrow",at:"at",from_now:"from now",ago:"ago",right_now:"right now",just_now:"just now",days:DAYS,pluralize:function(B,E){return 1<B?E+"s":E}};return function(B){var E=k(B),G=E.now||new Date,H=E.texts||x,O=G-this,P=0>=O;if((O=Math.abs(O))<=E.nowThreshold)return P?H.right_now:H.just_now;if(E.smartDays&&O<=6*v)return p(this,G,H);var Q=null;for(var R in q){if(O<q[R])break;O/=q[Q=R]}return[O=Math.floor(O),Q=H.pluralize(O,Q),P?H.from_now:H.ago].join(" ")}}(),Date.fromString=function(k){return new Date(Date.parse(k))},Math.degRad=function(k){return k*Math.PI/180},Math.degSin=function(k){return Math.sin(Math.degRad(k))},Math.degCos=function(k){return Math.cos(Math.degRad(k))};function add_to_dates(k,p,q){return"undefined"==typeof k[p]?k[p]=[q]:k[p].push(q),k}function astronomy(k,p,q){var v=get_UTCDate(),x=SunCalc.getTimes(v,k,p),B=[SunCalc.getMoonIllumination(v),SunCalc.getMoonTimes(v,k,p)],E=[do_solar(v,x),do_lunar(v,B),day_length(x)];document.querySelector("#"+q+" .conditions span:nth-child(8)").innerHTML="<p>"+E.join(" ").trim()+"</p>"}function chinese_new_year(k){return{2000:["05 Feb","dragon"],2001:["24 Jan","snake"],2002:["12 Feb","horse"],2003:["01 Feb","goat"],2004:["22 Jan","monkey"],2005:["09 Feb","rooster"],2006:["29 Jan","dog"],2007:["18 Feb","pig"],2008:["07 Feb","rat"],2009:["26 Jan","ox"],2010:["14 Feb","tiger"],2011:["03 Feb","rabbit"],2012:["23 Jan","dragon"],2013:["10 Feb","snake"],2014:["31 Jan","horse"],2015:["19 Feb","goat"],2016:["08 Feb","monkey"],2017:["28 Jan","rooster"],2018:["16 Feb","dog"],2019:["05 Feb","pig"],2020:["25 Jan","rat"],2021:["12 Feb","ox"],2022:["01 Feb","tiger"],2023:["22 Jan","rabbit"],2024:["10 Feb","dragon"],2025:["29 Jan","snake"],2026:["17 Feb","horse"],2027:["06 Feb","goat"],2028:["26 Jan","monkey"],2029:["13 Feb","rooster"],2030:["03 Feb","dog"],2031:["23 Jan","pig"],2032:["11 Feb","rat"],2033:["31 Jan","ox"],2034:["19 Feb","tiger"],2035:["08 Feb","rabbit"],2036:["28 Jan","dragon"],2037:["15 Feb","snake"],2038:["04 Feb","horse"],2039:["24 Jan","goat"],2040:["12 Feb","monkey"],2041:["01 Feb","rooster"],2042:["22 Jan","dog"],2043:["10 Feb","pig"],2044:["30 Jan","rat"],2045:["17 Feb","ox"],2046:["06 Feb","tiger"],2047:["26 Jan","rabbit"],2048:["14 Feb","dragon"],2049:["02 Feb","snake"],2050:["23 Jan","horse"],2051:["11 Feb","goat"],2052:["01 Feb","monkey"],2053:["19 Feb","rooster"],2054:["08 Feb","dog"],2055:["28 Jan","pig"],2056:["15 Feb","rat"],2057:["04 Feb","ox"],2058:["24 Jan","tiger"],2059:["12 Feb","rabbit"],2060:["02 Feb","dragon"],2061:["21 Jan","snake"],2062:["09 Feb","horse"],2063:["29 Jan","goat"],2064:["17 Feb","monkey"],2065:["05 Feb","rooster"],2066:["26 Jan","dog"],2067:["14 Feb","pig"],2068:["03 Feb","rat"],2069:["23 Jan","ox"],2070:["11 Feb","tiger"],2071:["31 Jan","rabbit"],2072:["19 Feb","dragon"],2073:["07 Feb","snake"],2074:["27 Jan","horse"],2075:["15 Feb","goat"],2076:["05 Feb","monkey"],2077:["24 Jan","rooster"],2078:["12 Feb","dog"],2079:["02 Feb","pig"],2080:["22 Jan","rat"],2081:["09 Feb","ox"],2082:["29 Jan","tiger"],2083:["17 Feb","rabbit"],2084:["06 Feb","dragon"],2085:["26 Jan","snake"],2086:["14 Feb","horse"],2087:["03 Feb","goat"],2088:["24 Jan","monkey"],2089:["10 Feb","rooster"],2090:["30 Jan","dog"],2091:["18 Feb","pig"],2092:["07 Feb","rat"],2093:["27 Jan","ox"],2094:["15 Feb","tiger"],2095:["05 Feb","rabbit"],2096:["25 Jan","dragon"],2097:["12 Feb","snake"],2098:["01 Feb","horse"],2099:["21 Jan","goat"]}[k]||null}function close_sentence(k){return 0<k.length&&(k=k.join(" ")),[k+"."]}function colder_or_hotter(k,p,q,v,x){var B="";if("yesterday"==q&&v[0]==k)B="cold";else if("yesterday"==q&&x[0]==k)B="cold";else return null==p[0]||null==k?"":p[0]+p[3]<=k&&k>=p[0]-p[4]?B:(B=k>p[0]+p[3]?"warm":"cool","It is "+B+"er than");return"It is the "+B+"est ever recorded"}function compile_dates(){var k=new Date().getUTCFullYear(),p={"12 Apr":["Yuri's Night"],"16 Apr":["Foursquare Day"],"23 Apr":["St George's Day"],"12 Aug":["Glorious Twelfth"],"15 Aug":["Assumption of Mary"],"24 Dec":["Christmas Eve"],"25 Dec":["Christmas Day","There was a partridge in a pear tree"],"26 Dec":["Boxing Day","There were two turtle doves"],"27 Dec":["There were three french hens"],"28 Dec":["There were four calling birds"],"29 Dec":["There were five gold rings"],"30 Dec":["There were six geese a-laying"],"31 Dec":["New Year's Eve","There were seven swans a-swimming"],"08 Dec":["Feast of the Immaculate Conception"],"14 Feb":["Valentine's Day"],"02 Feb":["Groundhog Day"],"01 Jan":["New Year's Day","There were eight maids a-milking"],"25 Jan":["Burns Night"],"02 Jan":["There were nine ladies dancing"],"03 Jan":["There were ten lords a-leaping"],"04 Jan":["There were eleven pipers piping"],"05 Jan":["Twelfth Night","There were twelve drummers drumming"],"06 Jan":["Epiphany"],"12 Jul":["Battle of the Boyne"],"04 Jul":["Independence Day (USA)"],"14 Jun":["Flag Day (USA)"],"14 Mar":["Pi Day"],"17 Mar":["St Patrick's Day"],"01 Mar":["St David's Day"],"25 May":["Towel Day"],"04 May":["Star Wars Day"],"11 Nov":["Remembrance Sunday"],"01 Nov":["All Saints' Day"],"02 Nov":["All Souls' Day"],"30 Nov":["St Andrew's Day"],"05 Nov":["Guy Fawkes Night"],"31 Oct":["Halloween"],"04 Oct":["Feast of St Francis of Assisi"]};p=doEaster(p,k),p=doChineseNewYear(p,k),p=doSpecialDays(p,k),p=p[get_Date(new Date().toUTCString(),!1)],"undefined"==typeof p?(p="",document.querySelector("#footer").style.display="none"):(p="<p>It is "+p.join(" .").trim()+".</p>",document.querySelector("#footer").style.display="block"),document.querySelector("#footer span:nth-child(1)").innerHTML=p}function convertUV(k){var p=SCALE_UV(parseInt(k)).hex();if(""==k||2>=k)return["L","low",p,"You can safely stay outside."];return 5>=k?["M","moderate",p,"Take care during midday hours and do not spend too much time in the sun unprotected."]:7>=k?["H","high",p,"Seek shade during midday hours, cover up and wear sunscreen."]:10>=k?["VH","very high",p,"Spend time in the shade between 11am and 3pm. A shirt, sunscreen and hat essential"]:["E","extreme",p,"Avoid being outside during midday hours. A shirt, sunscreen and hat are essential."]}function convert_Dobson_to_text(k){k=parseInt(0.21415*k);var p=SCALE_OZONE(k).hex();return 100>=k?["L","low",p]:160>=k?["M","moderate",p]:240>=k?["H","high",p]:["E","very high",p]}function convert_visibility(k){if(0.03>k)return"there is a dense fog";return 0.12>k?"there is thick fog":0.31>k?"there is a moderate fog":0.62>k?"there is a light fog":1.24>k?"there is thin fog":2.48>k?"the air is hazy":6.21>k?"there is a light haze":12.42>k?"the air is clear":31.07>k?"the air is very clear":172.12>k?"the air is exceptionally clear":"there is pure air"}function csv_to_array(k){for(var p=k.split("\n"),q=[],v=0;v<p.length;v++)0!=p[v].length&&q.push(p[v].split(","));return q}function day_length(k){try{var p=new Date(null);p.setSeconds((k.sunset-k.sunrise)/1e3),p=p.toISOString().substr(11,8).split(":");for(var q=0;3>q;q++)if(p[q]=parseInt(p[q]),isNaN(p[q]))throw"";var v="is";return new Date.getTime>=k.sunset&&(v="was"),"The day "+v+" "+p[0]+"h "+p[1]+"m "+p[2]+"s long."}catch(x){return""}}function doBackgroundColour(){var k=BACKGROUND_COLOURS.length,p=document.getElementById("content").offsetWidth;if(0<k&&(400<p||1==LOCATIONS.length)){for(var q=["to right",BACKGROUND_COLOURS[0]+" 0%"],v=0;v<k;v++)q.push(BACKGROUND_COLOURS[v]+" "+100/k+"%");document.body.style.backgroundImage="linear-gradient("+q.join(", ")+")"}else document.body.style.background=0<k?BACKGROUND_COLOURS[0]:"#ffffff"}function doChineseNewYear(k,p){var q=chinese_new_year(p);return null!=q&&add_to_dates(k,q[0],"Chinese New Year (Year of the "+toTitleCase(q[1])+")"),k}function doEaster(k,p){var q=when_is_easter(p);return k=add_to_dates(k,get_Date(new Date(1e3*(q-0)).toUTCString(),!1,2),"Easter Sunday"),k=add_to_dates(k,get_Date(new Date(1e3*(q-86400)).toUTCString(),!1,2),"Holy Saturday"),k=add_to_dates(k,get_Date(new Date(1e3*(q-172800)).toUTCString(),!1,2),"Good Friday"),k=add_to_dates(k,get_Date(new Date(1e3*(q-259200)).toUTCString(),!1,2),"Maundy Thursday"),k=add_to_dates(k,get_Date(new Date(1e3*(q-604800)).toUTCString(),!1,2),"Palm Sunday"),k=add_to_dates(k,get_Date(new Date(1e3*(q-1814400)).toUTCString(),!1,2),"Mothering Sunday"),k=add_to_dates(k,get_Date(new Date(1e3*(q-4060800)).toUTCString(),!1,2),"Shrove Tuesday / Pancake Day"),k=add_to_dates(k,get_Date(new Date(1e3*(q-3974400)).toUTCString(),!1,2),"Ash Wednesday"),k=add_to_dates(k,get_Date(new Date(1e3*(q+86400)).toUTCString(),!1,2),"Easter Monday"),k=add_to_dates(k,get_Date(new Date(1e3*(q+3369600)).toUTCString(),!1,2),"Feast of the Ascension"),k=add_to_dates(k,get_Date(new Date(1e3*(q+4233600)).toUTCString(),!1,2),"Pentecost / Whitsunday"),k=add_to_dates(k,get_Date(new Date(1e3*(q+4838400)).toUTCString(),!1,2),"Trinity Sunday"),k=add_to_dates(k,get_Date(new Date(1e3*(q+5184000)).toUTCString(),!1,2),"Corpus Christi"),k}function doSpecialDays(k,p){add_to_dates(k,get_Date(new Date(1e3*getMonthlyWeekday(3,"Monday","February",p)).toUTCString(),!1,2),"Presidents' Day (USA)"),add_to_dates(k,get_Date(new Date(1e3*getMonthlyWeekday(3,"Monday","January",p)).toUTCString(),!1,2),"Martin Luther King Jr Day (USA)"),add_to_dates(k,get_Date(new Date(1e3*getMonthlyWeekday(1,"Monday","May",p)).toUTCString(),!1,2),"May Day bank holiday"),add_to_dates(k,get_Date(new Date(1e3*getMonthlyWeekday(2,"Saturday","June",p)).toUTCString(),!1,2),"Trooping the Colour"),add_to_dates(k,get_Date(new Date(1e3*getMonthlyWeekday(3,"Sunday","June",p)).toUTCString(),!1,2),"Father's Day"),add_to_dates(k,get_Date(new Date(1e3*getMonthlyWeekday(1,"Monday","September",p)).toUTCString(),!1,2),"Labor Day (USA)"),add_to_dates(k,get_Date(new Date(1e3*getMonthlyWeekday(2,"Monday","October",p)).toUTCString(),!1,2),"Columbus Day (USA)"),add_to_dates(k,get_Date(new Date(1e3*getMonthlyWeekday(4,"Thursday","November",p)).toUTCString(),!1,2),"Thanksgiving (USA)"),add_to_dates(k,get_Date(new Date(1e3*(getMonthlyWeekday(4,"Thursday","November",p)+86400)).toUTCString(),!1,2),"Black Friday"),add_to_dates(k,get_Date(new Date(1e3*(getMonthlyWeekday(4,"Thursday","November",p)+345600)).toUTCString(),!1,2),"Cyber Monday"),add_to_dates(k,get_Date(new Date(1e3*getLastXdays("Monday","May",p)).toUTCString(),!1,2),"Spring bank holiday / Memorial Day (USA)"),add_to_dates(k,get_Date(new Date(1e3*getLastXdays("Monday","August",p)).toUTCString(),!1,2),"Summer bank holiday");for(var q=new Date(p+"/12/25").getTime();0!=new Date(q).getUTCDay();)q-=8.64e7;return add_to_dates(k,get_Date(new Date(q-1814400000).toUTCString(),!1,2),"Advent Sunday"),q=getLastXdays("Sunday","March",p),add_to_dates(k,get_Date(new Date(1e3*(q-86400)).toUTCString(),!1,2),"The clocks go forward one hour tonight.  Spring forward."),add_to_dates(k,get_Date(new Date(1e3*(q-0)).toUTCString(),!1,2),"The clocks went forward one hour last night.  Spring forward."),q=getLastXdays("Sunday","October",p),add_to_dates(k,get_Date(new Date(1e3*(q-86400)).toUTCString(),!1,2),"The clocks go back one hour tonight.  Fall back."),add_to_dates(k,get_Date(new Date(1e3*(q-0)).toUTCString(),!1,2),"The clocks went back one hour last night.  Fall back."),q=Date.getSeasons(),add_to_dates(k,get_Date(q[1].toUTCString(),!1,2),"Vernal equinox"),add_to_dates(k,get_Date(q[2].toUTCString(),!1,2),"Summer solstice"),add_to_dates(k,get_Date(q[3].toUTCString(),!1,2),"Autumnal equinox"),add_to_dates(k,get_Date(q[4].toUTCString(),!1,2),"Winter solstice"),k}function do_last_precipitate(k,p,q){var v=[["snow",9],["rain",8]],x=[];for(var B in v)q[v[B][1]]!=p[0]&&x.push(v[B][0]+"ed "+new Date(1e3*q[v[B][1]]).toRelativeTime({smartDays:!0}));0<x.length&&(document.querySelector("#"+k+" .conditions span:nth-child(5)").innerHTML="<p>It last "+x.join(" and ")+".</p>")}function do_lunar(k,p){var q=[];if("undefined"!=typeof p[1].alwaysUp)q.push("The"),q.push(get_phase(p)),q.push("will not set below the horizon today.");else if("undefined"!=typeof p[1].alwaysDown)q.push("The"),q.push(get_phase(p)),q.push("will not rise above the horizon today.");else{q.push("There is a"),q.push(get_phase(p));var v=["rise","set"];for(var x in p[1].set<p[1].rise&&(v=["set","rise"]),v)if(k<p[1][v[x]]){q.push("and it will"),q.push(v[x]),q.push("at "+get_time(p[1][v[x]]));break}q=close_sentence(q)}return q.join(" ").trim()}function do_solar(k,p){var q=[];return k<p.nadir?q.push("The darkest point of the night is at "+get_time(p.nadir)+" ("+p.nadir.toRelativeTime()+")."):k<p.sunrise?(k<p.dawn&&(q.push("Dawn"),p.dawn<=k?q.push("was"):q.push("is"),q.push("at "+get_time(p.dawn)),q=close_sentence(q)),q=is_at("The sun will rise at",p.sunrise,q,k)):k<p.goldenHourEnd?(q.push("The sun rose at "+get_time(p.sunrise)+" and the golden hour will end "+p.goldenHourEnd.toRelativeTime()+" at "+get_time(p.goldenHourEnd)),q=close_sentence(q)):k<p.solarNoon?q.push("The sun will be highest in the sky at "+get_time(p.solarNoon)+"."):k<p.dusk&&(k<p.goldenHour&&(q.push("The golden hour starts at "+get_time(p.goldenHour)),3.6e6>=p.goldenHour-k&&q.push("("+p.goldenHour.toRelativeTime()+")")),1<q.length&&(q=close_sentence(q)),k<p.sunset&&(q=is_at("The sun will set at",p.sunset,q,k)),k<p.dusk&&q.push("Dusk is at "+get_time(p.dusk)+".")),q.join(" ").trim()}function endsWith(k,p){return-1!==k.indexOf(p,k.length-p.length)}function fetchCSV(k){for(var p=csv_to_array(k),q=p.length,v=p[q-1],x=parseFloat(v[0]),B=parseFloat(v[1]),E=0;E<q;E++)for(var G in p[E][0]=E==q-1?parseFloat(p[E][0]):B*p[E][0]+x,p[E])(E==q-1||0!=G&&4!=G&&10!=G&&""!=p[E][G])&&(p[E][G]=parseFloat(p[E][G]));return p[q-1][5]=B*p[q-1][5]+x,p[q-1][7]=B*p[q-1][7]+x,p[q-1][8]=B*p[q-1][8]+x,p[q-1][9]=B*p[q-1][9]+x,[p.slice(0,q-1),v]}function find_correction(k,p){var q=get_UTCDate().getTime()/1e3,v=q-3600*p,x=get_element(k,1,v,q),B=get_element(k,6,v,q);return ss.mean(x.map(function(E,G){return E-B[G]}))}function getBeaufortScale(k){return k=Math.round(k),4>k?"a light wind":4<=k&&8>k?"light breeze":8<=k&&13>k?"gentle breeze":13<=k&&19>k?"breeze":19<=k&&25>k?"fresh breeze":25<=k&&32>k?"strong breeze":32<=k&&39>k?"moderate gale force wind":39<=k&&47>k?"fresh gale force wind":47<=k&&55>k?"strong gale force wind":55<=k&&64>k?"storm force wind":64<=k&&74>k?"violent storm force wind":74<=k?"hurricane force wind":k+" mph wind"}function getHumidityString(k){return"The humidity is "+k+"%."}function getLastXdays(k,p,q){var v=new Date,x=[];for(v.setYear(q),v.setMonth(MONTHS.indexOf(p)),v.setDate(1);v.getUTCDay()!==DAYS.indexOf(k);)v.setDate(v.getUTCDate()+1);for(;v.getUTCMonth()===MONTHS.indexOf(p);)x.push(v.getTime()),v.setDate(v.getUTCDate()+7);return 86400*parseInt(x[x.length-1]/8.64e7)}function getMonthlyWeekday(k,p,q,v){for(var x,B=0,E=1,G=DAYS.indexOf(p);B<k&&31>E;)x=new Date(E++ +" "+q+" "+v),x.getUTCDay()==G&&B++;return!(B!=k)&&x.getTime()/1e3}function getOzone(k){var[p,q,v]=convert_Dobson_to_text(k);return"L"==p?"":"<p><span class=\"diamond\" style=\"background-color: "+v+"\">"+p+"</span> The ozone level is "+q+" ("+k+" Dobson units).</p>"}function getPressures(k,p){var q=[],v=get_UTCDate()/1e3,B=get_element(k,7,v-43200,v,!0),E=ss.linearRegression(B).m,G="";return[E,G]=getWeatherFromPressure(p,E),q.push("The pressure is "+p+" mbar and "+E+"."),""!=G&&q.push("Expect "+G+" for the next 12 hours."),"<p>"+q.join(" ").trim()+"</p>"}function getRelativeTime(k){return new Date(1e3*k).toRelativeTime({smartDays:!1,nowThreshold:60000})}function getTemperatureString(k,p=!1,q=!1){return!1!=p&&!1!=q?"<abbr title=\"Recorded value of "+round_to_one(p)+"&deg;C (with a correction factor of "+round_to_one(q)+"&deg;C)\">"+round_to_one(k)+"&deg;C</abbr> / "+round_to_one(Feels.tempConvert(k,"c","f"))+"&deg;F":round_to_one(k)+"&deg;C / "+round_to_one(Feels.tempConvert(k,"c","f"))+"&deg;F"}function getTextColour(k){var p=chroma(k);return 0.179<p.luminance()?p.darken(2).hex():p.brighten(4).hex()}function getUV(k){var p,q,v;return[k,v,q,v]=convertUV(k),"<p><span class=\"diamond\" style=\"background-color: "+q+"\">"+k+"</span>&nbsp;The UV level is "+p+". "+v+"</p>"}function getVisibility(k,p){var q=[];return""!=p&&(p=parseInt(p),0==p?q.push("There are no clouds"):q.push("There is "+p+"% cloud cover")),""!=k&&0<k&&(q.push(convert_visibility(k)+"."),q=[q.join(" and ")],q.push("You can see for "+k+" miles.")),"<p>"+q.join(" ").trim()+"</p>"}function getWeatherFromPressure(k,p){var q="";return-0.25>p?(q=1022<k&&-0.5>p?"cloudier and warmer conditions":1022<k?"fair weather":1010>k&&-0.5>p?"a storm":1010>k?"precipitation":-0.5>p?"some precipitation":"little change in the weather",p="falling"):0.25<p?(q=sub_pressure(k),p="rising"):(q=sub_pressure(k),p="steady"),[q,p]}function getWindString(k,p,q){var v={speed:0,gust:!1,direction:""},x=["There is a"];return v.speed=Math.max(parseFloat(k,p)),p>=k&&(v.gust=!0),0<v.speed&&""!=q&&(v.direction=q),0<v.speed&&(v.gust&&x.push("gusty"),x.push(getBeaufortScale(v.speed)),""!=v.direction&&x.push("from the "+v.direction+".")),1==x.length&&(x=[]),[v.speed,x.join(" ").trim()]}function get_Date(k,p=!1,q=1){var v=k.split(" "),x=[];return v[1].length>q&&(q=v[1].length),x.push(zeroPad(v[1],q)),x.push(v[2]),p&&x.push(zeroPad(v[3],4)),x.join(" ").trim()}function get_UTCDate(){var k=new Date;return k=Date.UTC(k.getUTCFullYear(),k.getUTCMonth(),k.getUTCDate(),k.getUTCHours(),k.getUTCMinutes(),k.getUTCSeconds()),new Date(k)}function get_data(k){var p=k.charAt(0).toLowerCase();fetch("data/"+p+".latest",{cache:"no-cache"}).then(function(v){return v.text()}).then(function(v){main(k,v)})}function get_element(k,p,q,v,x=!1){return k=k.filter(function(B){if(B[0]>=q&&v>=B[0]&&"undefined"!=typeof B[p]&&""!=B[p])return B}),x?k.map(function(B){return[B[0],B[p]]}):k.map(function(B){return B[p]})}function get_phase(k){var p=[moon_phase(k[0].phase),"moon","with "+Math.round(100*k[0].fraction,0)+"% of it visible"];return p.join(" ").trim()}function get_time(k,p=!1){var q=[];return!0==p&&q.push(get_Date(k.toUTCString(),!0)),q.push(zeroPad(k.getUTCHours(),2)+":"+zeroPad(k.getUTCMinutes(),2)),q.join(" at ").trim()}function is_at(k,p,q,v){return v<p&&(q.push(k),q.push(get_time(p)),3.6e6>=p-v&&q.push("("+p.toRelativeTime()+")")),close_sentence(q)}function joinSentence(k){return[k.slice(0,-1).join(", "),k.slice(-1)[0]].join(2>k.length?"":" and ")}function last_updated(k,p){document.getElementById(p+"_updated").innerHTML="<p>The latest weather from "+toTitleCase(p)+" was recorded "+getRelativeTime(k)+".</p>"}function last_x_days(k,p){var q=get_UTCDate()/1e3,v=86400*parseInt(q/86400)-86400*k,x=v+86400*k;return v==x&&(x=q),p=get_element(p,1,v,x),[ss.mean(p),ss.min(p),ss.max(p),ss.standardDeviation(p)]}function main(k,p){null!=LAST_UPDATED[k]&&window.clearTimeout(LAST_UPDATED[null]),0==LOCATIONS.indexOf(k)&&compile_dates(),document.querySelector("#"+k+" .conditions").innerHTML="<span class=\"summary\"></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span>";var[q,v]=fetchCSV(p),x=q[q.length-1],B=find_correction(q,24),[E,G]=getWindString(x[8],x[9],x[10]),H="#ffffff";[H,document.querySelector("#"+k+" .conditions span:nth-child(2)").innerHTML]=processTemperatures(H,x[1],x[2],E,B,q,[v[4],v[5]],[v[6],v[7]]);var O=getTextColour(H);BACKGROUND_COLOURS.push(H),document.getElementById(k).style.backgroundColor=H,document.getElementById(k+"_updated").style.backgroundColor=H,document.getElementById(k).style.color=O,document.getElementById(k+"_updated").style.color=O;var P=new Skycons({color:O,resizeClear:!0});P.remove("icon"),P.add(document.querySelector("#"+k+" .icon"),ICONS[x[5]-1]);var Q=["summary","wind","visibility","battery","pressure","uv","ozone","updated"];for(var R in Q){var S=Q[R],T=AVAILABLE.indexOf(S);(""!=x[T]||0==x[T])&&("summary"==S?document.querySelector("#"+k+" .conditions span:nth-child(1)").innerHTML="<p>"+x[T]+"</p>":"updated"==S?last_updated(x[0],k):"wind"==S?document.querySelector("#"+k+" .conditions span:nth-child(3)").innerHTML="<p>"+G+"</p>":"visibility"==S?document.querySelector("#"+k+" .conditions span:nth-child(6)").innerHTML=getVisibility(x[T],x[T-2]):"battery"==S?""!=x[T]&&30>x[T]&&(document.querySelector("#footer span:nth-child(2)").innerHTML="<p>&#128267; The battery in "+k+" is getting low - "+x[T]+"% remaining &#128267;</p>"):"uv"==S?0<x[12]&&(document.querySelector("#"+k+" .conditions span:nth-child(8)").innerHTML=getUV(x[12])):"ozone"==S?0<x[14]&&(document.querySelector("#"+k+" .conditions span:nth-child(9)").innerHTML=getOzone(x[14])):"pressure"==S&&(document.querySelector("#"+k+" .conditions span:nth-child(4)").innerHTML=getPressures(q,x[7])))}do_last_precipitate(k,x,v),astronomy(v[2],v[3],k),doBackgroundColour(),P.play(),LAST_UPDATED[k]=window.setInterval(function(){0==LOCATIONS.indexOf(k)&&compile_dates(),do_last_precipitate(k,x,v),astronomy(v[2],v[3],k),last_updated(x[0],k)},15000)}function moon_phase(k){if(0.05>k)return"new";return 0.2>k?"waxing cresent":0.3>k?"first quarter":0.45>k?"waxing gibbous":0.55>k?"full":0.7>k?"waning gibbous":0.8>k?"last quarter":"waning cresent"}function page_setup(){for(var k in document.getElementById("content").innerHTML="",document.getElementById("content").width=400*LOCATIONS.length,document.title="Weather for "+joinSentence(LOCATIONS),LOCATIONS){var p=LOCATIONS[k],q=document.createElement("section");q.setAttribute("id",p),q.setAttribute("class","background"),q.setAttribute("style","grid-row: 1 / span 1"),document.getElementById("content").appendChild(q),q=document.createElement("canvas"),q.setAttribute("class","icon"),q.setAttribute("width","128px"),q.setAttribute("height","128px"),document.getElementById(p).appendChild(q),q=document.createElement("br"),document.getElementById(p).appendChild(q),q=document.createElement("article"),q.setAttribute("class","conditions"),document.getElementById(p).appendChild(q),q=document.createElement("section"),q.setAttribute("id",p+"_updated"),q.setAttribute("class","updated"),q.setAttribute("style","grid-row: 2 / span 1"),document.getElementById("content").appendChild(q)}q=document.createElement("section"),q.setAttribute("id","footer"),document.getElementById("content").appendChild(q),q=document.createElement("span"),document.getElementById("footer").appendChild(q),q=document.createElement("span"),document.getElementById("footer").appendChild(q),update_page()}function processTemperatures(k,p,q,v,x,B,E,G){var H=[];if(""!=p&&""!=q){var O={temp:parseFloat(p-x),humidity:parseFloat(q),speed:v,round:!1,units:{temp:"c",speed:"mph"}},P=new Feels(O);k=SCALE_TEMPERATURE(P.like()).hex(),H.push("It is "+getTemperatureString(P.temp,p,x)),P.temp!=P.like()&&H.push("but it feels like "+getTemperatureString(P.like())+"."),H.push(getHumidityString(q))}else""==p?""!=q&&H.push(getHumidityString(q)):H.push(getTemperatureString(P.temp));0>=P.temp&&-80<=P.temp?P.temp<=P.getFrostPoint()&&H.push("There may be some frost on the ground."):P.temp<=P.getDewPoint()&&H.push("There may be some dew on the grass.");var Q=last_x_days(0,B),R={yesterday:1,"last week":7,"last month":28};for(var S in R){var T=colder_or_hotter(Q[0],last_x_days(R[S],B),S,E,G);if(""!=T){endsWith(T,"than")&&(T=T+" "+S),H.push(T+".");break}}return[k,"<p>"+H.join(" ").trim()+"</p>"]}function round_to_one(k){return(Math.round(10*k)/10).toFixed(1)}function sub_pressure(k){if(1022<k)return"continued fair weather";return 1010>k?"cooler and clearer weather":"the weather to stay the same"}function toTitleCase(k){return k.replace(/\w\S*/g,function(p){return p.charAt(0).toUpperCase()+p.substr(1).toLowerCase()})}function update_page(){for(var k in LOCATIONS)BACKGROUND_COLOURS=[],k=LOCATIONS[k],get_data(k);window.setTimeout(function(){update_page()},3e5)}function when_is_easter(k){var p=Math.floor(k/100),q=k-19*Math.floor(k/19),v=Math.floor((p-17)/25),x=p-Math.floor(p/4)-Math.floor((p-v)/3)+19*q+15;x-=30*Math.floor(x/30),x-=Math.floor(x/28)*(1-Math.floor(x/28)*Math.floor(29/(x+1))*Math.floor((21-q)/11));var B=k+Math.floor(k/4)+x+2-p+Math.floor(p/4);B-=7*Math.floor(B/7);var E=x-B,G=3+Math.floor((E+40)/44),H=E+28-31*Math.floor(G/4);return new Date(zeroPad(H,2)+" "+MONTHS[G-1].slice(0,3)+k).getTime()/1e3}function zeroPad(k,p,q){var v="undefined"==typeof q?"0":q,x=Array(1+p).join(v);return(x+k).slice(-x.length)}page_setup();
